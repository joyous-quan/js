<!DOCTYPE html>
<html>
<head>
    <title>购物车</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="/css/cart.css">
  
</head>
<body>
    <div class="header">
        <ul class="layout header_nav">
			<li class="left">xx 商城</li>
			<li>联系我们</li>
			<li>产品</li>
			<li>首页</li>
		</ul>
    </div>
    <div class="container" style="min-height:808px;">
        <div class="layout con">
            <h3>我的购物车</h3>
            <table id="table" border="0" cellspacing="0" cellpadding="0" class="">
                <thead>
                    <tr>
                        <th>
                            <input type="checkbox" id="allCheck" />&nbsp; 全选
                        </th>
                        <th>
                            图片
                        </th>
                        <th width="30%">
                            名称
                        </th>
                        <th>
                            数量
                        </th>
                        <th>
                            单价
                        </th>
                        <th>
                            小计
                        </th>
                        <th>
                            操作
                        </th>
                    </tr>
                </thead>
                <tbody id="tbody">
                   <!-- <tr>
                       <td>
                           <input type="checkbox" class="ck" name="checkitem" />
                       </td>
                       <td>
                           <img src="/img/1.png" alt="" />
                       </td>
                       <td>
                           BD-0001
                       </td>
                       <td>readonly="readonly"
                           <button class="down">&nbsp;-&nbsp;</button><input type="text" value="1" readonly style="width:36px;text-align:center;" /><button class="up">&nbsp;+&nbsp;</button>
                       </td>
                       <td>
                           ￥<span class="unitPrice">111</span>
                       </td>
                       <td>
                           ￥<span class="subtotal">111</span>
                       </td>
                       <td>
                           <button class="del">删除</button>
                       </td>
                   </tr>-->
                </tbody>
            </table>
            <div class="box" id="box">购物车里没有任何商品</div>
            <h4 id="h2">总价格：￥ <span id="totalPrice">0</span></h4>
            <div >
                <p class="back_"><a href="index.html">返回产品列表</a></p>  
            </div>
        </div>
    </div>
	<div class="footer">
		<ul class="layout">
			<li class="left">&copy; copyRight @2018 <a href="mailto:joyousquan@outlook.com">Contact Us</a></li>
		</ul>
	</div>


<!--操作cookie的js文件-->
<script src="/js/jquery.js" ></script>
<script src="/js/cookie.js"></script>
<script src="/js/server.js"></script>
<script>
    $(function(){
        var listObj = getAllData();
        if(listObj.length == 0) {
            $('.box table').addClass('hide')
        } else {
            $('.box table').removeClass('hide')
            for(var i = 0, len = listObj.length; i < len; i++) {
                var tr = document.createElement("tr");
                tr.setAttribute("pid", listObj[i].pid);
                    //{"pid":值,"pImg":值,"pName":值,"price":值,"pCount":值},
                tr.innerHTML = '<td>' +
                    '<input type="checkbox" class="ck" /></td><td>' +
                    '<img src="' + listObj[i].pImg + '" alt="" />' +
                    '</td><td>' + listObj[i].pName +'</td><td>' +
                    '<button class="down">&nbsp;-&nbsp;</button><input style="width:60px;text-align:center;" type="text" value="' + listObj[i].pCount + '" readonly="readonly" /><button class="up">&nbsp;+&nbsp;</button>' +
                    '</td><td>' +
                    '￥<span class="unitPrice">' + listObj[i].price + '</span>' +
                    '</td><td>' +
                    '￥<span class="subtotal">' + listObj[i].price * listObj[i].pCount + '</span>' +
                    '</td><td>' +
                    '<button class="del" >删除</button></td>';
                $('#tbody').append(tr);
            }
        }


        /*JQuery实现全选/全不选，取消子checkbox时，全选checkbox取消对勾号*/
       /*$("#allCheck").click(function () {//判断全选框的改变
            var boolean1 = $(this).is(":checked");//全选选中为true，否则为false
            $("table input[type=checkbox]").each(function () {
                $(this).prop("checked", boolean1);
            })
        });
        //当子元素都选全选选中，其中一个不选取消全选
        $("input[name=checkitem]").click(function () {
            var boolean2 = true;
            for (var i = 0; i < $("input[name=checkitem]").length; i++) {
                if (!$($("input[name=checkitem]")[i]).is(":checked")) {
                    boolean2 = false;
                    break;
                }
            }
            $("#allCheck").prop("checked", boolean2);

        })*/
        /* 删除 */
        $('.del').click(function(event){
          console.log($(this).parent().parent().index())
          var idx = $(this).parent().parent().index();
                console.log(listObj[idx])
            if(confirm('确定要删除吗')){
                $(this).parent().parent().remove();
                console.log(listObj)
                cookieObj.del(listObj[idx]);
            }
        })
        /* 数值加减 */
        $('.down').click(function(event){
            var num = Number($(this).parent().find('input').val());
            $(this).parent().find('input').val(num - 1);
            
            var price = Number($(this).parent().siblings().find('.unitPrice').html());
            var subtotalPrice = price * (num-1);
            //console.log(subtotalPrice);
            if(num <2){
                $(this).parent().find('input').val(num);
                var subtotalPrice = price * 1;
                alert('宝贝不能再少啦')
            }
            $(this).parent().siblings().find('.subtotal').html(subtotalPrice);

            totalPrice.innerHTML = getTotalPrice();
        })
        $('.up').click(function(event){
            var num = Number($(this).parent().find('input').val());
            $(this).parent().find('input').val(num + 1);

            var price = Number($(this).parent().siblings().find('.unitPrice').html());
            var subtotalPrice = price * (num+1);
            //console.log(subtotalPrice);
            $(this).parent().siblings().find('.subtotal').html(subtotalPrice);

            totalPrice.innerHTML = getTotalPrice();
        })


        var cks = $('.ck');
        function getTotalPrice() {
            var sum = 0;
            for(var i = 0, len = cks.length; i < len; i++) {
                if(cks[i].checked) { 
                    var tr = cks[i].parentNode.parentNode;
                    var temp = tr.children[5].firstElementChild.innerHTML;
                    sum = Number(temp) + sum;
                    //console.log(sum)
                }
            }
            return sum;
        }

        for(var i = 0, len = cks.length; i < len; i++) {
            cks[i].onchange = function() {
                checkAllChecked();
                totalPrice.innerHTML = getTotalPrice();
            }
        }

        allCheck.onchange = function() {
            if(this.checked) {
                for(var i = 0, len = cks.length; i < len; i++) {
                    cks[i].checked = true;
                }
            } else {
                for(var i = 0, len = cks.length; i < len; i++) {
                    cks[i].checked = false;
                }
            }
            totalPrice.innerHTML = getTotalPrice();
        }
        function checkAllChecked() {
            var isSelected = true;
            for(var j = 0, len = cks.length; j < len; j++) {
                if(cks[j].checked == false) {
                    isSelected = false;
                    break;
                }
            }
            allCheck.checked = isSelected;
        }
    

    })






</script>
</body>
</html>