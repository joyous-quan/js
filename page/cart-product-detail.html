<!DOCTYPE html>
<html>
<head>
	<title>产品详情页</title>
	<meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="/css/common.css">
    <link rel="stylesheet" type="text/css" href="/css/cart.css">

</head>
<body>
<div class="base-body">
    <header id="header"></header>

    <div class="layout">
        <div class="mycar">
            <a href="/page/cart.html">我的购物车</a> 
        </div>
        <br><br>
        <h2>产品详情</h2>
        
        <div class="product_list list alljson details-con">
            <!-- <ul>
                <li class="floatL"><img src="/img/1.png"></li>
                <li class="floatR">
                   <p>产品中文名：<span>5-溴-1,3-二氟-2-硝基苯</span>(请以英文为准,中文仅做参考)</p>
                   <p>产品英文名：<span>5-Bromo-1,3-difluoro-2-nitrobenzene</span></p><br>
                   <p>价格：<span>$128.00</span> &nbsp; &nbsp; &nbsp; 数量：<input style="width:36px;height:20px;" type="number" value="1" min="1" max="10"></p><br>
                   <a href="javascript:;" class="btn">加入购物车</a>
               </li>
            </ul> -->
        </div>
    </div>
	<div class="footer">
		<ul class="layout">
			<li class="left">&copy; copyRight @2019 <a href="mailto:joyousquan@outlook.com">Contact</a></li>
		</ul>
	</div>
</div>
<!--cookie操作的js库-->
<script src="/tool/js/jquery-2.1.1.min.js"></script>
<script src="/js/common.js" ></script>
<script src="/tool/js/cookie.js"></script>
<script src="/js/server.js"></script>
<script>
$(function(){
    //获取url中的参数
    /*function getUrlParam(name) {
       var reg = new RegExp('(^|&)' + name + '=([^&]*)(&|$)'); //构造一个含有目标参数的正则表达式对象
       var r = window.location.search.substr(1).match(reg);  //匹配目标参数
       if (r != null) return unescape(r[2]); return null; //返回参数值
    }*/
    function getUrlParam(name) {
        var reg = new RegExp('(^|&)' + name + '=([^&]*)(&|$)');
        var r = window.location.search.substr(1).match(reg);
        if(r != null) return unescape(r[2]);
        return null;
    }

   //接收URL中的参数Id
   var id = getUrlParam('id');
    $.ajax({
        type:'get',
        url:'/data/cart.json',
        dataType:'json',
        success:function(res,status){
            $.each(res, function(idx,item) {
                //根据id获取详情数据
                if(id == item.id){
                    var str = "<ul class='ul' pid='"+item.id+"'><li class='floatL'><img src='"+item.img+"'/></li>"
                        +"<li class='floatR'>产品中文名："+item.CNname+"(请以英文为准,中文仅做参考)</li>"
                        +"<li class='floatR'>产品英文名：<span class='pName'>"+item.ENname+"</span></li>"
                        +"<li class='floatR'>价格：$<span class='price'>"+item.price1+"</span></li>"
                        +"<li class='floatR'> 数量：<input style='width:36px;height:20px;text-align:center;' type='number' value='1' min='1' max='99'></li>"
                        +"<li class='floatR'><a href='javascript:;' class='btn' onclick='addCart()'>加入购物车</a></li></ul>";
                }
                $('.alljson').append(str);
                
            });
           
        }
    })

});

function addCart() {
    var listStr = cookieObj.get("datas_cart");
    if(!listStr) { 
        cookieObj.set({
            name: "datas_cart",
            value: "[]"
        });
        listStr = cookieObj.get("datas_cart");
    }
    var listObj = JSON.parse(listStr);
    var ul = $('.ul')
    var pid = ul.attr("pid");//获取自定义属性
    var pCount = Number(ul.find('input').val());
    if(checkObjByPid(pid)) {
        listObj = updateObjById(pid, pCount);
        console.log(listObj);
        //console.log(cookieObj.get("datas_cart"));
    } else {
        var imgSrc = ul.find('img').attr('src');
        var pName = ul.find('.pName').html();
        var price = ul.find('.price').html();
        var obj = {
            pid: pid,
            pImg: imgSrc,
            pName: pName,
            price: price,
            pCount: pCount
        };

        listObj.push(obj);
        listObj = updateData(listObj);
        //console.log(listObj);
        //console.log(listStr);
        $('#ccount').html( getTotalCount());
    }
    $('#ccount').html( getTotalCount());  
    alert('添加成功！') 
}

</script>
</body>
</html>
